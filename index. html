<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Space Dodge</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(180deg, #0a0520 0%, #1a0f3e 100%);
      overflow: hidden;
    }

    html {
      height: 100%;
    }

    main {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #game {
      position: relative;
      width: 100%;
      flex: 1;
      background: radial-gradient(ellipse at center, #1a0f3e 0%, #0a0520 100%);
      overflow: hidden;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .spaceship {
      position: absolute;
      width: 50px;
      height: 50px;
      transition: left 0.1s linear;
      filter: drop-shadow(0 0 12px #00d4ff);
    }

    .spaceship svg {
      width: 100%;
      height: 100%;
    }

    .asteroid {
      position: absolute;
      width: 45px;
      height: 45px;
      filter: drop-shadow(0 0 8px #ff3366);
    }

    .asteroid svg {
      width: 100%;
      height: 100%;
      animation: rotate 3s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    #hud {
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      z-index: 10;
    }

    .score-display {
      background: rgba(0, 0, 0, 0.7);
      padding: 12px 20px;
      border-radius: 10px;
      color: #00ff88;
      font-size: 1.3em;
      font-weight: bold;
      border: 2px solid #00ff88;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
    }

    .speed-indicator {
      background: rgba(0, 0, 0, 0.7);
      padding: 12px 20px;
      border-radius: 10px;
      color: #ffaa00;
      font-size: 1.1em;
      font-weight: bold;
      border: 2px solid #ffaa00;
      box-shadow: 0 0 15px rgba(255, 170, 0, 0.5);
    }

    #title {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #00d4ff;
      font-size: 3em;
      font-weight: bold;
      text-shadow: 0 0 30px #00d4ff;
      z-index: 5;
    }

    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      z-index: 10;
    }

    .control-btn {
      width: 70px;
      height: 70px;
      font-size: 2em;
      background: rgba(0, 212, 255, 0.2);
      border: 3px solid #00d4ff;
      border-radius: 15px;
      color: #00d4ff;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
    }

    .control-btn:hover {
      background: rgba(0, 212, 255, 0.4);
      transform: scale(1.05);
    }

    .control-btn:active {
      transform: scale(0.95);
    }

    #startBtn {
      position: absolute;
      top: 55%;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px 50px;
      font-size: 1.5em;
      font-weight: bold;
      background: linear-gradient(135deg, #00d4ff 0%, #0088ff 100%);
      border: none;
      border-radius: 15px;
      color: white;
      cursor: pointer;
      box-shadow: 0 5px 25px rgba(0, 212, 255, 0.6);
      transition: all 0.3s;
      z-index: 5;
    }

    #startBtn:hover {
      transform: translateX(-50%) translateY(-3px);
      box-shadow: 0 8px 35px rgba(0, 212, 255, 0.8);
    }

    #gameOverOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .game-over-box {
      background: linear-gradient(135deg, #1a0f3e 0%, #0a0520 100%);
      border: 4px solid #ff3366;
      border-radius: 20px;
      padding: 50px;
      text-align: center;
      box-shadow: 0 0 50px rgba(255, 51, 102, 0.8);
      max-width: 90%;
    }

    .game-over-box h2 {
      color: #ff3366;
      font-size: 3em;
      margin: 0 0 20px 0;
      text-shadow: 0 0 20px #ff3366;
    }

    .game-over-box .final-score {
      color: #00ff88;
      font-size: 2em;
      font-weight: bold;
      margin: 20px 0;
    }

    .game-over-box .milestone-info {
      color: #ffaa00;
      font-size: 1.2em;
      margin: 10px 0;
    }

    .game-over-box button {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 1.3em;
      font-weight: bold;
      background: linear-gradient(135deg, #00d4ff 0%, #0088ff 100%);
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0, 212, 255, 0.5);
      transition: all 0.3s;
    }

    .game-over-box button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0, 212, 255, 0.7);
    }

    @media (max-width: 600px) {
      #title {
        font-size: 2em;
      }

      .score-display, .speed-indicator {
        font-size: 1em;
        padding: 8px 15px;
      }

      .control-btn {
        width: 60px;
        height: 60px;
        font-size: 1.5em;
      }

      .game-over-box h2 {
        font-size: 2em;
      }

      .game-over-box .final-score {
        font-size: 1.5em;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <main>
   <div id="game">
    <div id="hud">
     <div class="score-display">
      SCORE: <span id="score">0</span>
     </div>
     <div class="speed-indicator">
      LEVEL: <span id="speedLevel">1</span>
     </div>
     <div class="score-display">
      HIGH: <span id="highScore">0</span>
     </div>
    </div>
    <h1 id="title">SPACE DODGE</h1><button id="startBtn">START GAME</button>
    <div class="spaceship" id="ship">
     <svg viewbox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><defs>
       <lineargradient id="shipGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#0088ff;stop-opacity:1" />
       </lineargradient>
      </defs> <polygon points="25,5 45,45 25,35 5,45" fill="url(#shipGradient)" stroke="#00ffff" stroke-width="1" /> <circle cx="25" cy="20" r="3" fill="#ffffff" opacity="0.8" />
     </svg>
    </div>
    <div id="controls"><button class="control-btn" id="leftBtn" aria-label="Move left">◀</button> <button class="control-btn" id="rightBtn" aria-label="Move right">▶</button>
    </div>
    <div id="gameOverOverlay">
     <div class="game-over-box">
      <h2 id="gameOverText">GAME OVER!</h2>
      <div class="final-score">
       SCORE: <span id="finalScore">0</span>
      </div>
      <div class="milestone-info">
       MAX LEVEL: <span id="maxLevel">1</span>
      </div>
      <div class="final-score" style="font-size: 1.3em;">
       HIGH: <span id="finalHighScore">0</span>
      </div><button id="restartBtn">PLAY AGAIN</button>
     </div>
    </div>
   </div>
  </main>
  <script>
    const defaultConfig = {
      game_title: "SPACE DODGE",
      start_button_text: "START GAME",
      game_over_text: "GAME OVER!",
      primary_color: "#00d4ff",
      accent_color: "#00ff88",
      asteroid_color: "#ff3366"
    };

    let config = {};

    const game = document.getElementById('game');
    const ship = document.getElementById('ship');
    const scoreEl = document.getElementById('score');
    const highScoreEl = document.getElementById('highScore');
    const speedLevelEl = document.getElementById('speedLevel');
    const titleEl = document.getElementById('title');
    const startBtn = document.getElementById('startBtn');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const finalScoreEl = document.getElementById('finalScore');
    const finalHighScoreEl = document.getElementById('finalHighScore');
    const maxLevelEl = document.getElementById('maxLevel');
    const restartBtn = document.getElementById('restartBtn');
    const gameOverTextEl = document.getElementById('gameOverText');

    let shipX = 0;
    let asteroids = [];
    let score = 0;
    let highScore = localStorage.getItem('spaceHighScore') || 0;
    let speed = 2;
    let currentLevel = 1;
    let gameRunning = false;
    let asteroidInterval;
    let moveInterval;
    let keys = {};

    const milestones = [10, 20, 30, 50, 70];
    const speedIncrements = [0.5, 0.7, 1, 1.2, 1.5];

    highScoreEl.textContent = highScore;

    function createStars() {
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
        star.style.animationDelay = Math.random() * 3 + 's';
        game.appendChild(star);
      }
    }

    function updateShip() {
      ship.style.left = shipX + 'px';
    }

    function createAsteroid() {
      if (!gameRunning) return;

      const asteroid = document.createElement('div');
      asteroid.className = 'asteroid';
      asteroid.style.left = Math.random() * (game.offsetWidth - 45) + 'px';
      asteroid.style.top = '-45px';
      
      const asteroidColor = config.asteroid_color || defaultConfig.asteroid_color;
      asteroid.innerHTML = `
        <svg viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
          <polygon points="25,2 35,15 48,18 40,30 45,45 25,38 5,45 10,30 2,18 15,15" 
                   fill="${asteroidColor}" stroke="#ff0044" stroke-width="2"/>
          <circle cx="20" cy="20" r="3" fill="#660011" opacity="0.5"/>
          <circle cx="32" cy="28" r="2" fill="#660011" opacity="0.5"/>
        </svg>
      `;
      
      game.appendChild(asteroid);
      asteroids.push(asteroid);
    }

    function moveAsteroids() {
      if (!gameRunning) return;

      asteroids.forEach((asteroid, index) => {
        let top = parseFloat(asteroid.style.top);
        asteroid.style.top = (top + speed) + 'px';

        const rectA = asteroid.getBoundingClientRect();
        const rectS = ship.getBoundingClientRect();
        
        if (!(rectA.right < rectS.left || 
              rectA.left > rectS.right || 
              rectA.bottom < rectS.top || 
              rectA.top > rectS.bottom)) {
          endGame();
        }

        if (top > game.offsetHeight) {
          asteroid.remove();
          asteroids.splice(index, 1);
          score++;
          scoreEl.textContent = score;

          for (let i = 0; i < milestones.length; i++) {
            if (score === milestones[i]) {
              speed += speedIncrements[i];
              currentLevel = i + 2;
              speedLevelEl.textContent = currentLevel;
              break;
            }
          }
        }
      });
    }

    function startGame() {
      const gameRect = game.getBoundingClientRect();
      shipX = gameRect.width / 2 - 25;
      asteroids.forEach(a => a.remove());
      asteroids = [];
      score = 0;
      speed = 2;
      currentLevel = 1;
      gameRunning = true;
      scoreEl.textContent = score;
      speedLevelEl.textContent = currentLevel;
      titleEl.style.display = 'none';
      startBtn.style.display = 'none';
      gameOverOverlay.style.display = 'none';
      
      const bottomOffset = 100;
      ship.style.bottom = bottomOffset + 'px';
      
      updateShip();
      
      asteroidInterval = setInterval(createAsteroid, 1500);
      moveInterval = setInterval(moveAsteroids, 20);
    }

    function endGame() {
      gameRunning = false;
      clearInterval(asteroidInterval);
      clearInterval(moveInterval);
      
      finalScoreEl.textContent = score;
      maxLevelEl.textContent = currentLevel;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('spaceHighScore', highScore);
        highScoreEl.textContent = highScore;
      }
      
      finalHighScoreEl.textContent = highScore;
      gameOverOverlay.style.display = 'flex';
    }

    document.getElementById('leftBtn').addEventListener('click', () => {
      if (!gameRunning) return;
      shipX -= 40;
      if (shipX < 0) shipX = 0;
      updateShip();
    });

    document.getElementById('rightBtn').addEventListener('click', () => {
      if (!gameRunning) return;
      shipX += 40;
      if (shipX > game.offsetWidth - 50) shipX = game.offsetWidth - 50;
      updateShip();
    });

    window.addEventListener('keydown', (e) => {
      if (['ArrowLeft', 'ArrowRight'].includes(e.key)) {
        e.preventDefault();
      }
      keys[e.key] = true;
    });

    window.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });

    setInterval(() => {
      if (!gameRunning) return;
      
      if (keys['ArrowLeft']) {
        shipX -= 8;
        if (shipX < 0) shipX = 0;
        updateShip();
      }
      if (keys['ArrowRight']) {
        shipX += 8;
        if (shipX > game.offsetWidth - 50) shipX = game.offsetWidth - 50;
        updateShip();
      }
    }, 20);

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    async function onConfigChange(newConfig) {
      titleEl.textContent = newConfig.game_title || defaultConfig.game_title;
      startBtn.textContent = newConfig.start_button_text || defaultConfig.start_button_text;
      gameOverTextEl.textContent = newConfig.game_over_text || defaultConfig.game_over_text;
      
      const primaryColor = newConfig.primary_color || defaultConfig.primary_color;
      const accentColor = newConfig.accent_color || defaultConfig.accent_color;
      
      titleEl.style.color = primaryColor;
      titleEl.style.textShadow = `0 0 30px ${primaryColor}`;
      
      const controlBtns = document.querySelectorAll('.control-btn');
      controlBtns.forEach(btn => {
        btn.style.borderColor = primaryColor;
        btn.style.color = primaryColor;
        btn.style.boxShadow = `0 0 20px ${primaryColor}66`;
      });
      
      const scoreDisplays = document.querySelectorAll('.score-display');
      scoreDisplays.forEach(display => {
        display.style.color = accentColor;
        display.style.borderColor = accentColor;
        display.style.boxShadow = `0 0 15px ${accentColor}80`;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            },
            {
              get: () => config.asteroid_color || defaultConfig.asteroid_color,
              set: (value) => {
                config.asteroid_color = value;
                window.elementSdk.setConfig({ asteroid_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
          ["game_over_text", config.game_over_text || defaultConfig.game_over_text]
        ])
      });
      
      config = window.elementSdk.config;
      onConfigChange(config);
    }

    createStars();
    const gameRect = game.getBoundingClientRect();
    shipX = gameRect.width / 2 - 25;
    const bottomOffset = 100;
    ship.style.bottom = bottomOffset + 'px';
    updateShip();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a228f94f592a8fc',t:'MTc2Mzc1MzAwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
